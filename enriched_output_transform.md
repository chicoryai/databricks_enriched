{"response": "Part 1: SQL Transformation Query  \n\n```sql\n{{ config(materialized = 'view') }}   -- dbt model: high_risk_customers.sql\n\nWITH recent_txns AS (               -- 30-day transaction slice\n    SELECT\n        a.customer_id,\n        t.id              AS transaction_id,\n        CAST(t.amount AS DECIMAL(18,2)) AS amount\n    FROM transactions t                                     -- [Doc-145]\n    JOIN accounts      a ON a.id = t.account_id             -- [Doc-142]\n    WHERE t.timestamp >= CURRENT_DATE - INTERVAL '30' DAY\n),\n\navg_txn AS (                        -- average amount per customer\n    SELECT\n        customer_id,\n        AVG(amount) AS avg_amount_30d\n    FROM recent_txns\n    GROUP BY customer_id\n),\n\nfraud_customers AS (                -- customers with \u22651 fraud flag in 30 days\n    SELECT DISTINCT\n        a.customer_id\n    FROM fraud_flags f                                   -- [Doc-143 \u201cfraud_flags\u201d]\n    JOIN transactions t  ON t.id = f.transaction_id\n    JOIN accounts     a  ON a.id = t.account_id\n    WHERE t.timestamp >= CURRENT_DATE - INTERVAL '30' DAY\n),\n\nkyc AS (                             -- latest / only KYC record\n    SELECT\n        customer_id,\n        status AS kyc_status\n    FROM kyc_info                                          -- [Doc-Updated_financial_schema p.3]\n)\n\nSELECT\n    fc.id           AS customer_id,\n    fc.name,\n    fc.email,\n    at.avg_amount_30d,\n    k.kyc_status\nFROM fixed_customers  fc                                   -- [Doc-142]\nJOIN avg_txn          at ON fc.id = at.customer_id\nJOIN fraud_customers  f  ON fc.id = f.customer_id\nJOIN kyc              k  ON fc.id = k.customer_id\nWHERE at.avg_amount_30d > 1000      -- risk threshold\n  AND k.kyc_status != 'verified';\n```\n\nPart 2: JSON Output Schema  \n\n```json\n{\n  \"table_name\": \"high_risk_customers\",\n  \"columns\": [\n    {\n      \"column_name\": \"customer_id\",\n      \"column_description\": \"Unique identifier for each customer\",\n      \"derivation_logic\": \"Taken from fixed_customers.id after all risk-criteria joins and filters\",\n      \"sample_value\": \"c9f4d0c1-3e8b-4ad1-a9c2-11be1d2a6c55\",\n      \"enhanced_column_description\": \"Customer primary key originating from fixed_customers that survives all risk filters\"\n    },\n    {\n      \"column_name\": \"name\",\n      \"column_description\": \"Customer\u2019s full name\",\n      \"derivation_logic\": \"Selected directly from fixed_customers.name\",\n      \"sample_value\": \"Jane Doe\",\n      \"enhanced_column_description\": \"Customer full name supplied by fixed_customers for analyst readability\"\n    },\n    {\n      \"column_name\": \"email\",\n      \"column_description\": \"Customer\u2019s email address\",\n      \"derivation_logic\": \"Selected directly from fixed_customers.email\",\n      \"sample_value\": \"jane.doe@example.com\",\n      \"enhanced_column_description\": \"Email pulled from fixed_customers to enable outreach by Compliance\"\n    },\n    {\n      \"column_name\": \"avg_amount_30d\",\n      \"column_description\": \"Average transaction amount in the last 30 days\",\n      \"derivation_logic\": \"AVG(transactions.amount) over 30-day window after joining through accounts\",\n      \"sample_value\": \"1523.75\",\n      \"enhanced_column_description\": \"30-day average transaction value calculated in CTE avg_txn\"\n    },\n    {\n      \"column_name\": \"kyc_status\",\n      \"column_description\": \"Latest Know-Your-Customer verification status\",\n      \"derivation_logic\": \"Fetched from kyc_info.status for the customer\",\n      \"sample_value\": \"pending\",\n      \"enhanced_column_description\": \"Current KYC status from kyc_info indicating verification state\"\n    }\n  ],\n  \"business_process_overview\": \"The high_risk_customers view equips the Risk & Compliance team to focus investigations on clients whose 30-day average spend exceeds $1 000, have at least one fraud-flagged transaction, and remain unverified in KYC\u2014integrating behavioural, fraud, and regulatory signals into a single actionable list.\"\n}\n```", "suggestions": []}
